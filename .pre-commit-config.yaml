# MAT-12: Pre-commit configuration for automated code quality checks
# See https://pre-commit.com for more information
repos:
  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-toml
      - id: check-yaml
        args:
          - --unsafe
        exclude: docker-compose.*\.yml$
      - id: check-merge-conflict
      - id: end-of-file-fixer
        exclude: |
            (?x)^(
                frontend/src/client/.*|
                backend/app/email-templates/build/.*|
                .*\.md$
            )$
      - id: trailing-whitespace
        exclude: |
            (?x)^(
                frontend/src/client/.*|
                .*\.md$
            )$

  # Ruff linting and formatting (replaces Black, isort, Flake8)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.9
    hooks:
      - id: ruff-check
        args: [--fix]
        exclude: |
          (?x)^(
              backend/app/alembic/versions/.*\.py|
              .*__pycache__.*
          )$
      - id: ruff-format
        exclude: |
          (?x)^(
              backend/app/alembic/versions/.*\.py|
              .*__pycache__.*
          )$

  # MyPy type checking (disabled temporarily due to missing type stubs)
  # TODO: Re-enable once proper type stubs are configured
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.17.1
  #   hooks:
  #     - id: mypy
  #       files: ^backend/app/
  #       exclude: |
  #         (?x)^(
  #             backend/app/alembic/.*|
  #             backend/app/tests/.*|
  #             backend/htmlcov/.*
  #         )$
  #       additional_dependencies:
  #         - types-passlib
  #         - pydantic
  #         - sqlmodel
  #         - fastapi
  #       args: [--config-file, backend/pyproject.toml]

  # Local hooks for testing
  - repo: local
    hooks:
      # Run backend tests with pytest (excluding problematic test for now)
      - id: pytest-backend
        name: pytest (backend tests)
        entry: bash -c 'cd backend && uv run pytest app/tests/ -x --tb=short --ignore=app/tests/scripts/'
        language: system
        types: [python]
        files: ^backend/app/
        pass_filenames: false
        always_run: false

ci:
  autofix_commit_msg: ðŸŽ¨ [pre-commit.ci] Auto format from pre-commit.com hooks
  autoupdate_commit_msg: â¬† [pre-commit.ci] pre-commit autoupdate
